<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Listado de Establecimientos</title>

  <!-- Bootstrap + DataTables -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">

  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

  <!-- Estilo corporativo -->
  <style>
    body {
      background-color: #f4f6f9;
      font-family: "Segoe UI", sans-serif;
      color: #333;
    }

    .navbar {
      background-color: #0d47a1 !important;
      color: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .navbar-brand {
      color: #fff !important;
      font-weight: 600;
      letter-spacing: 0.4px;
    }

    .card {
      border: none;
      border-radius: 0.8rem;
      box-shadow: 0 3px 8px rgba(0,0,0,0.05);
    }

    .section-title {
      font-weight: 600;
      color: #0d47a1;
      border-left: 5px solid #0d47a1;
      padding-left: 12px;
      margin-bottom: 18px;
      font-size: 1.3rem;
    }

    .badge {
      font-size: 0.85rem;
      padding: 6px 10px;
    }

    table thead {
      background-color: #0d47a1;
      color: white;
    }

    table.dataTable tbody tr.table-danger {
      background-color: #ffebee !important;
    }

    #filtroRIS select {
      border-radius: 0.4rem;
      box-shadow: none;
      border: 1px solid #0d47a1;
    }
  </style>

</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg px-4 mb-4">
  <a class="navbar-brand" href="/">üìä Dashboard</a>
  <a class="navbar-brand ms-4" href="/establecimientos">üè• Establecimientos</a>
</nav>

<div class="container mb-5">

  <h2 class="section-title">Listado de Establecimientos</h2>

  <div class="card p-4">

      <!-- Dropdown de filtro RIS -->
      <div id="filtroRIS" class="mb-3" style="max-width:260px;"></div>

      <!-- TABLA -->
      <table id="tabla_est" class="table table-hover table-bordered align-middle">
        <thead>
          <tr>
            <th>RIS</th>
            <th>RENIPRESS</th>
            <th>ESTABLECIMIENTO</th>
            <th>FECHA Y HORA DE CARGA</th>
            <th>ESTADO</th>
          </tr>
        </thead>
        <tbody>
          {% for x in detalle %}
          <tr class="{{ 'table-danger' if x.ARCHIVOS == '‚Äî' else '' }}">
            <td>{{ x.RIS }}</td>
            <td>{{ x.RENIPRES }}</td>
            <td>{{ x.ESTABLECIMIENTO }}</td>
            <td>{{ x.FECHA_CARGA }}</td>
            <td>
              {% if x.ARCHIVOS != '‚Äî' %}
                <span class="badge bg-success">Cargado</span>
              {% else %}
                <span class="badge bg-danger">Sin carga</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

  </div>
</div>

<!-- SCRIPT DATATABLES + FILTRO RIS -->
<script>
$(document).ready(function () {

    if ($.fn.DataTable.isDataTable('#tabla_est')) {
        $('#tabla_est').DataTable().clear().destroy();
    }

    let tabla = $('#tabla_est').DataTable({
        pageLength: 15,
        order: [[0, 'asc']],
        language: { url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json' },
        initComplete: function () {
            let columnaRIS = this.api().column(0);
            let select = $('<select class="form-select form-select-sm"><option value="">Filtrar por RIS</option></select>')
                .appendTo($("#filtroRIS"))
                .on('change', function () {
                    columnaRIS.search($(this).val()).draw();
                });

            columnaRIS.data().unique().sort().each(function (d) {
                select.append('<option value="' + d + '">' + d + '</option>');
            });
        }
    });

});
</script>

</body>
</html>
